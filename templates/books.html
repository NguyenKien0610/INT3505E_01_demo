{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Quản lý sách</h3>
  <a class="btn btn-primary" href="/books/new">+ Thêm sách</a>
</div>

<!-- Ô tìm kiếm -->
<form method="get" class="d-flex mb-3" role="search">
  <input class="form-control me-2" type="search" name="q" value="{{ search }}" placeholder="Tìm theo tên hoặc tác giả">
  <button class="btn btn-outline-success" type="submit">Tìm</button>
</form>

<!-- Bảng danh sách sách -->
<table class="table table-striped">
  <thead>
    <tr>
      <th>STT</th>
      <th>Tên</th>
      <th>Tác giả</th>
      <th>Thể loại</th>
      <th>Năm XB</th>
      <th>Kho</th>
      <th width="180">Hành động</th>
    </tr>
  </thead>
  <tbody>
    {% for b in books %}
    <tr>
      <!-- STT tăng theo trang -->
      <td>{{ loop.index + (page - 1) * 5 }}</td>
      <td>{{ b.title }}</td>
      <td>{{ b.author }}</td>
      <td>{{ b.genre or '—' }}</td>
      <td>{{ b.year or '—' }}</td>
      <td>{{ b.available_copies }}/{{ b.total_copies }}</td>
      <td>
        <a class="btn btn-sm btn-outline-secondary" href="/books/{{ b.id }}/edit">Sửa</a>
        <form action="/books/{{ b.id }}/delete" method="post" class="d-inline" onsubmit="return confirm('Xoá sách?');">
          <button class="btn btn-sm btn-outline-danger" type="submit">Xoá</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="7" class="text-center">Chưa có sách</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Thanh phân trang -->
{% if total_pages > 1 %}
<nav aria-label="Pagination" class="mt-3">
  <ul class="pagination justify-content-center">
    {% if page > 1 %}
      <li class="page-item">
        <a class="page-link" href="?q={{ search }}&page={{ page-1 }}&limit=5">« Trang trước</a>
      </li>
    {% endif %}

    <li class="page-item disabled">
      <a class="page-link">Trang {{ page }} / {{ total_pages }}</a>
    </li>

    {% if page < total_pages %}
      <li class="page-item">
        <a class="page-link" href="?q={{ search }}&page={{ page+1 }}&limit=5">Trang sau »</a>
      </li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}
